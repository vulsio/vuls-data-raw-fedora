{
	"alias": "FEDORA-EPEL-2012-0577",
	"bugs": [
		{
			"bug_id": 791001,
			"parent": true,
			"security": true,
			"title": "CVE-2012-1053 Puppet 2.6.13 group ID handling issues",
			"bugzilla": {
				"bug_id": "791001",
				"alias": "CVE-2012-1053",
				"creation_ts": "2012-02-15 22:07:07 +0000",
				"short_desc": "CVE-2012-1053 Puppet 2.6.13 group ID handling issues",
				"delta_ts": "2021-02-24 13:08:10 +0000",
				"bug_status": "CLOSED",
				"resolution": "CURRENTRELEASE",
				"keywords": "Security",
				"priority": "medium",
				"bug_severity": "medium",
				"depends_on": [
					"790898",
					"790917",
					"801972",
					"801974",
					"809594"
				],
				"blocked": [
					{
						"bug_id": "742180",
						"error": "NotPermitted"
					},
					{
						"bug_id": "767031",
						"error": "NotPermitted"
					}
				],
				"long_desc": [
					{
						"isprivate": "0",
						"commentid": "4433107",
						"comment_count": "0",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-02-15 22:07:07 +0000",
						"thetext": "\nThere have been two vulnerabilities discovered in Puppet\n(CVE-2012-1053 and CVE-2012-1054).  Puppet Labs is currently working\nwith distribution\nmaintainers, as well as key customers to ensure we are able to patch\nthis vulnerability before it is exploited.\n\nThe CVEs and issues have not been made public yet. We appreciate your\ndiscretion at this time. We have included patches for 2.6.x and 2.7.x.\nIf you need help with patches for other series or versions of Puppet,\nplease let us know.\n\n\n# Summary #\n\n(#12457, #12459) Execs, when run with a user specified but with no\ngroup specified will get root group, so the exec then gets unintended\nprivileges. This is a permanent change for the forked process. Exploit\nrequires access to either the command the exec will run or to the\nmanifests calling execs.\n\n(#12458) Similarly unexpected privileges are given to providers and\ntypes (egid remains as root).\n\n# Details #\n\nCVE-2012-1053 GID Issues (#12457, #12458, #12459) [ Medium ]\n\n#12457 - Real gid always present in supplementary groups\n\n  Overview\n  ===================================================\n  In Puppet::Util::SUIDManager, Puppet tries to re-init the supplementary\n  groups in the \"initgroups\" method.  At\n  lib/puppet/util/suidmanager.rb:148, it reads:\n\n   Process.initgroups(Etc.getpwuid(user).name, Process.gid)\n\n  Since the real gid is probably root, this always adds the gid \"0\" to\n  the list of supplementary groups for the process as per this strace for\n  a change to my user account (with 7 supplementary groups):\n\n   setgroups(8, [0, 10, 14, 18, 54, 1002, 1004, 474]) = 0\n\n  This method is called by SUIDManager's change_user method, which is\n  called in critical places such as lib/puppet/util.rb:308 in\n  execute_posix (as used by lots of things including Exec resources).\n\n\n#12458 - Only euid changed, not egid\n\n  Overview\n  ===============================\n  The second problem occurs when only a target user is given to the\n  SUIDManager asuser method as opposed to a target user and group, as is\n  the case in the following places:\n   lib/puppet/provider/ssh_authorized_key/parsed.rb:59\n   lib/puppet/type/file/target.rb:46\n\n  In this case, the SUIDManager asuser method at\n  lib/puppet/util/suidmanager.rb:78 doesn't change the egid, only the\n  euid, so the egid remains as root.\n\n  It seems to me that the gid should be set sensibly if only the user is\n  specified, rather than the default of root.\n\n  Demo\n  ========\n  I've used the following contrived manifest to demonstrate these two\n  issues leave us with group privs, but I haven't thought of a reasonable\n  way to exploit this under normal conditions.\n\n   ssh_authorized_key { \"test\":\n     ensure => present,\n     key    => \"AAAA\",\n     type   => \"ssh-rsa\",\n     user   => \"nobody\",\n     target => \"/tmp/suidbug/file\",\n   }\n\n  Then:\n  # mkdir /tmp/suidbug\n  # touch /tmp/suidbug/file\n  # chmod -R g+w /tmp/suidbug\n  # ll /tmp/suidbug/file\n  -rw-rw-r--. 1 root root 0 Feb  4 20:17 /tmp/suidbug/file\n  # puppet apply sshauthkeys.pp\n  notice: /Stage[main]//Ssh_authorized_key[test]/ensure: created\n  err: /Stage[main]//Ssh_authorized_key[test]: Could not evaluate:\n  Puppet::Util::FileType::FileTypeFlat could not write /tmp/suidbug/file:\n  Permission denied - /tmp/suidbug/file\n  notice: Finished catalog run in 0.03 seconds\n  # ll /tmp/suidbug/file\n  -rw-rw-r--. 1 root root 196 Feb  4 20:19 /tmp/suidbug/file\n  # cat /tmp/suidbug/file\n  # HEADER: This file was autogenerated at Sat Feb 04 20:19:04 +0100 2012\n  # HEADER: by puppet.  While it can still be managed manually, it\n  # HEADER: is definitely not recommended.\n  ssh-rsa AAAA test\n\n\n#12459 - Permanent uid change doesn't drop supplementary groups\n\n  Overview\n  ========\n  When execute_posix or similar forks and calls SUIDManager's change_user\n  method, it sets permanent=true to change the real uid instead of the\n  euid (lib/puppet/util.rb:307).\n\n  In change_user, a different code path is taken when a permanent change\n  is made, and so the supplementary groups aren't dropped\n  (lib/puppet/util/suidmanager.rb:121), even if the primary group is set.\n\n  Demo\n  ========\n  This is really easy:\n\n  # cat setgid.pp\n  exec { \"/usr/bin/id\":\n   user      => \"nobody\",\n   group     => \"nobody\",\n   logoutput => true,\n  }\n\n  # puppet apply setgid.pp\n  notice: /Stage[main]//Exec[/usr/bin/id]/returns: uid=99(nobody)\n  gid=99(nobody)\n  groups=99(nobody),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),1004(sshusers)\n  context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023"
					},
					{
						"isprivate": "0",
						"commentid": "4433135",
						"comment_count": "3",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-02-15 22:22:00 +0000",
						"thetext": "This is embargoed, no release date has been set yet, I have contacted PuppetLabs and requested more information."
					},
					{
						"isprivate": "0",
						"commentid": "4433154",
						"comment_count": "4",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-02-15 22:28:21 +0000",
						"thetext": "Created attachment 562348\nPatch for CVE-2012-1053 and CVE-2012-1054"
					},
					{
						"isprivate": "0",
						"commentid": "4433871",
						"comment_count": "5",
						"who": {
							"text": "thoger",
							"name": "Tomas Hoger"
						},
						"bug_when": "2012-02-16 08:15:34 +0000",
						"thetext": "(In reply to comment #3)\n> This is embargoed, no release date has been set yet, I have contacted\n> PuppetLabs and requested more information.\n\nDominic researched these problems, adding to CC."
					},
					{
						"isprivate": "0",
						"commentid": "4466295",
						"comment_count": "7",
						"who": {
							"text": "tmz",
							"name": "Todd Zullinger"
						},
						"bug_when": "2012-02-22 05:46:02 +0000",
						"thetext": "Per conversation with Michael Stahnke at Puppet Labs, the release that was planned for tonight has been pushed to tomorrow.  I noticed a minor regression in the 2.6.14 packages we'll be using, so they're going to fix that up before release."
					},
					{
						"isprivate": "0",
						"commentid": "4471079",
						"comment_count": "8",
						"who": {
							"text": "vdanen",
							"name": "Vincent Danen"
						},
						"bug_when": "2012-02-23 17:05:45 +0000",
						"thetext": "External Reference:\n\nhttp://puppetlabs.com/security/cve/cve-2012-1053/"
					},
					{
						"isprivate": "0",
						"commentid": "4507417",
						"comment_count": "9",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-03-10 00:50:08 +0000",
						"thetext": "Created puppet tracking bugs for this issue\n\nAffects: fedora-all [bug 801972]"
					},
					{
						"isprivate": "0",
						"commentid": "4507426",
						"comment_count": "10",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-03-10 00:51:33 +0000",
						"thetext": "Created puppet tracking bugs for this issue\n\nAffects: epel-all [bug 801974]"
					},
					{
						"isprivate": "0",
						"commentid": "4508067",
						"comment_count": "11",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-10 21:52:43 +0000",
						"thetext": "puppet-2.6.14-1.fc16 has been pushed to the Fedora 16 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508069",
						"comment_count": "12",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-10 21:53:04 +0000",
						"thetext": "puppet-2.6.14-1.fc15 has been pushed to the Fedora 15 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508576",
						"comment_count": "13",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-11 17:01:58 +0000",
						"thetext": "puppet-2.6.14-1.fc17 has been pushed to the Fedora 17 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508647",
						"comment_count": "14",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-11 18:53:16 +0000",
						"thetext": "puppet-2.6.14-1.el5 has been pushed to the Fedora EPEL 5 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508649",
						"comment_count": "15",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-11 18:53:35 +0000",
						"thetext": "puppet-2.6.14-1.el6 has been pushed to the Fedora EPEL 6 stable repository.  If problems still persist, please make note of it in this bug report."
					}
				]
			}
		},
		{
			"bug_id": 791002,
			"parent": true,
			"security": true,
			"title": "CVE-2012-1054 Puppet 2.6.13 Klogin File Handling Issue",
			"bugzilla": {
				"bug_id": "791002",
				"alias": "CVE-2012-1054",
				"creation_ts": "2012-02-15 22:09:31 +0000",
				"short_desc": "CVE-2012-1054 Puppet 2.6.13 Klogin File Handling Issue",
				"delta_ts": "2021-02-24 13:08:12 +0000",
				"bug_status": "CLOSED",
				"resolution": "CURRENTRELEASE",
				"keywords": "Security",
				"priority": "medium",
				"bug_severity": "medium",
				"depends_on": [
					"790898",
					"790917",
					"801972",
					"801974",
					"809594"
				],
				"blocked": [
					{
						"bug_id": "742180",
						"error": "NotPermitted"
					},
					{
						"bug_id": "767031",
						"error": "NotPermitted"
					}
				],
				"long_desc": [
					{
						"isprivate": "0",
						"commentid": "4433110",
						"comment_count": "0",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-02-15 22:09:31 +0000",
						"thetext": "\nThere have been two vulnerabilities discovered in Puppet\n(CVE-2012-1053 and CVE-2012-1054).  Puppet Labs is currently working\nwith distribution\nmaintainers, as well as key customers to ensure we are able to patch\nthis vulnerability before it is exploited.\n\nThe CVEs and issues have not been made public yet. We appreciate your\ndiscretion at this time. We have included patches for 2.6.x and 2.7.x.\nIf you need help with patches for other series or versions of Puppet,\nplease let us know.\n\n\n# Summary #\n\n(#12460) Klogin type will write to untrusted locations (write through symlinks)\n\n#12460 - Klogin File Handling Issue (Write through symlink)\n\nHigh risk for users of this type. Users can symlink to arbitrary files, causing\nthem to be overwritten, such as other klogin files (including root)."
					},
					{
						"isprivate": "0",
						"commentid": "4433134",
						"comment_count": "3",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-02-15 22:21:50 +0000",
						"thetext": "This is embargoed, no release date has been set yet, I have contacted PuppetLabs and requested more information."
					},
					{
						"isprivate": "0",
						"commentid": "4433155",
						"comment_count": "4",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-02-15 22:28:25 +0000",
						"thetext": "Created attachment 562349\nPatch for CVE-2012-1053 and CVE-2012-1054"
					},
					{
						"isprivate": "0",
						"commentid": "4466296",
						"comment_count": "6",
						"who": {
							"text": "tmz",
							"name": "Todd Zullinger"
						},
						"bug_when": "2012-02-22 05:47:06 +0000",
						"thetext": "Per conversation with Michael Stahnke at Puppet Labs, the release that was planned for tonight has been pushed to tomorrow.  I noticed a minor regression in the 2.6.14 packages we'll be using, so they're going to fix that up before release."
					},
					{
						"isprivate": "0",
						"commentid": "4471081",
						"comment_count": "7",
						"who": {
							"text": "vdanen",
							"name": "Vincent Danen"
						},
						"bug_when": "2012-02-23 17:06:50 +0000",
						"thetext": "External Reference:\n\nhttp://puppetlabs.com/security/cve/cve-2012-1054/"
					},
					{
						"isprivate": "0",
						"commentid": "4507423",
						"comment_count": "8",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-03-10 00:50:30 +0000",
						"thetext": "Created puppet tracking bugs for this issue\n\nAffects: fedora-all [bug 801972]"
					},
					{
						"isprivate": "0",
						"commentid": "4507428",
						"comment_count": "9",
						"who": {
							"text": "kseifried",
							"name": "Kurt Seifried"
						},
						"bug_when": "2012-03-10 00:51:49 +0000",
						"thetext": "Created puppet tracking bugs for this issue\n\nAffects: epel-all [bug 801974]"
					},
					{
						"isprivate": "0",
						"commentid": "4508068",
						"comment_count": "10",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-10 21:52:51 +0000",
						"thetext": "puppet-2.6.14-1.fc16 has been pushed to the Fedora 16 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508070",
						"comment_count": "11",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-10 21:53:14 +0000",
						"thetext": "puppet-2.6.14-1.fc15 has been pushed to the Fedora 15 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508577",
						"comment_count": "12",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-11 17:02:06 +0000",
						"thetext": "puppet-2.6.14-1.fc17 has been pushed to the Fedora 17 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508648",
						"comment_count": "13",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-11 18:53:23 +0000",
						"thetext": "puppet-2.6.14-1.el5 has been pushed to the Fedora EPEL 5 stable repository.  If problems still persist, please make note of it in this bug report."
					},
					{
						"isprivate": "0",
						"commentid": "4508650",
						"comment_count": "14",
						"who": {
							"text": "updates",
							"name": "Fedora Update System"
						},
						"bug_when": "2012-03-11 18:53:41 +0000",
						"thetext": "puppet-2.6.14-1.el6 has been pushed to the Fedora EPEL 6 stable repository.  If problems still persist, please make note of it in this bug report."
					}
				]
			}
		}
	],
	"builds": [
		{
			"nvr": "puppet-2.6.14-1.el6",
			"signed": true,
			"type": "rpm",
			"package": {
				"noarch": [
					{
						"name": "puppet",
						"version": "2.6.14",
						"release": "1.el6",
						"arch": "noarch"
					},
					{
						"name": "puppet-server",
						"version": "2.6.14",
						"release": "1.el6",
						"arch": "noarch"
					}
				],
				"src": [
					{
						"name": "puppet",
						"version": "2.6.14",
						"release": "1.el6",
						"arch": "src"
					}
				]
			}
		}
	],
	"close_bugs": true,
	"comments": [
		{
			"id": 61661,
			"text": "This update has been submitted for testing by tmz. ",
			"timestamp": "2012-02-24 17:24:53",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		},
		{
			"id": 61662,
			"text": "This update is currently being pushed to the Fedora EPEL 6 testing updates repository.",
			"timestamp": "2012-02-24 20:15:31",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		},
		{
			"id": 61663,
			"text": "This update has been pushed to testing",
			"timestamp": "2012-02-24 23:38:43",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		},
		{
			"id": 61664,
			"text": "This update has reached 14 days in testing and can be pushed to stable now if the maintainer wishes",
			"timestamp": "2012-03-10 10:06:54",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		},
		{
			"id": 61665,
			"text": "This update has been submitted for stable by tmz. ",
			"timestamp": "2012-03-10 15:38:59",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		},
		{
			"id": 61666,
			"text": "This update is currently being pushed to the Fedora EPEL 6 stable updates repository.",
			"timestamp": "2012-03-11 16:56:42",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		},
		{
			"id": 61667,
			"text": "This update has been pushed to stable",
			"timestamp": "2012-03-11 18:53:42",
			"update_id": 8710,
			"user": {
				"avatar": "https://apps.fedoraproject.org/img/icons/bodhi-24.png",
				"id": 91,
				"name": "bodhi",
				"openid": "bodhi.id.fedoraproject.org"
			},
			"user_id": 91
		}
	],
	"content_type": "rpm",
	"date_pushed": "2012-03-11 18:53:42",
	"date_stable": "2012-03-11 18:53:42",
	"date_submitted": "2012-02-24 17:24:37",
	"date_testing": "2012-02-24 23:38:43",
	"notes": "Please refer to the upstream release notes for details:\r\n\r\nhttp://projects.puppetlabs.com/projects/1/wiki/Release_Notes#2.6.14",
	"pushed": true,
	"release": {
		"branch": "el6",
		"candidate_tag": "dist-6E-epel-testing-candidate",
		"composed_by_bodhi": true,
		"create_automatic_updates": false,
		"dist_tag": "dist-6E-epel",
		"id_prefix": "FEDORA-EPEL",
		"long_name": "Fedora EPEL 6",
		"mail_template": "fedora_epel_legacy_errata_template",
		"name": "EL-6",
		"override_tag": "dist-6E-epel-override",
		"package_manager": "unspecified",
		"stable_tag": "dist-6E-epel",
		"state": "archived",
		"testing_tag": "dist-6E-epel-testing",
		"version": "6"
	},
	"severity": "unspecified",
	"stable_karma": 3,
	"status": "stable",
	"suggest": "unspecified",
	"title": "puppet-2.6.14-1.el6",
	"type": "security",
	"url": "https://bodhi.fedoraproject.org/updates/FEDORA-EPEL-2012-0577",
	"unstable_karma": -3,
	"updateid": "FEDORA-EPEL-2012-0577",
	"user": {
		"avatar": "https://seccdn.libravatar.org/avatar/0ad6185a6acbd9fd4210c6d874b857b118e6373ea6e5fd3b56af40662c3a000b?s=24&d=retro",
		"email": "tmz@pobox.com",
		"groups": [
			{
				"name": "packager"
			},
			{
				"name": "ipausers"
			},
			{
				"name": "fedora-contributor"
			},
			{
				"name": "signed_fpca"
			},
			{
				"name": "fedorabugs"
			},
			{
				"name": "web"
			},
			{
				"name": "gitfedora-web"
			},
			{
				"name": "git-maint"
			},
			{
				"name": "gitkeychecker"
			}
		],
		"id": 136,
		"name": "tmz",
		"openid": "tmz.id.fedoraproject.org"
	},
	"version_hash": "fa1ff722a7410b54d598638bf266c3fe08a671ae"
}
